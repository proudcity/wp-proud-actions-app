!function($){angular.module("scrollTo",[]).run(["$rootScope",function($rootScope){/* currentYPosition -
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
var currentYPosition=function(){
// Firefox, Chrome, Opera, Safari
// Firefox, Chrome, Opera, Safari
// Internet Explorer 6 - standards mode
// Internet Explorer 6, 7 and 8
return window.pageYOffset?window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0};$rootScope.currentYPosition=currentYPosition,/* scrollTo -
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
$rootScope.scrollTo=function(eID,scrollDiv,quick){/* scrollTo -
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
function elmYPosition(eID){if(eID){for(var elm=document.getElementById(eID),y=elm.offsetTop,node=elm;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y}}
// This scrolling function 
// is from http://www.itnewb.com/tutorial/Creating-the-Smooth-Scroll-Effect-with-JavaScript
var i,startY=currentYPosition(),stopY=elmYPosition(eID),distance=stopY>startY?stopY-startY:startY-stopY;if(distance<100||quick)return void scrollTo(0,stopY);var speed=Math.round(distance/100);speed>=20&&(speed=20);var step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(stopY>startY)for(i=startY;i<stopY;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(i=startY;i>stopY;i-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,leapY<stopY&&(leapY=stopY),timer++}}]),
//***************************************
// Main Application
//***************************************
angular.module("311AppParent",["311App","angular-inview","angular-lazycompile"]).run(["$rootScope","$state","$stateParams","$window","$location",function($rootScope,$state,$stateParams,$window,$location){
// It's very handy to add references to $state and $stateParams to the $rootScope
$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.currentSection="",$rootScope.currentRoute="",$rootScope.externalLinkWindow=_.get(Proud,"settings.global.external_link_window")||!0,
//$rootScope.proudShowcaseKey = '325jk154hl3y8r2J34NRAasdfasdf';
//$rootScope.showcaseApiUrl='http://ui.dev.getproudcity.com/';  //@todo: switch to my.getproudcity.com
// $rootScope.proudcityApi='http://localhost:32790/api/proudcity/';
//$rootScope.proudcityApi='https://example.proudcity.com';
//$rootScope.proudcityApi='http://localhost:32804/api/proudcity/';
//$rootScope.proxyUrl = $rootScope.proudcityApi + 'proxy';
//$rootScope.paymentUrl = $rootScope.proudcityApi + 'invoice-example';
// Apply meta data if available
$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){
// Checks for back buttons, ect and makes sure
// slide functionality of app doesn't break
// Make sure the offcanvas resets for main window
_.get(toState,"data.undoMainToggle")&&$rootScope.toggleMain("slide-left","remove"),
// Make sure offcanvas resets for child windows
_.get(toState,"data.undoChildToggle")&&$rootScope.toggleMain("slide-left","remove","-"+_.get(toState,"data.undoChildToggle"))}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){
// send tracking
if($window.ga){
// normal path + more concise path
var path=$location.path(),subPath=path.indexOf("city/")>=0?path.substring(path.indexOf("city/")+5):path;
// Furthermore, if on faq node...
"city.faq.child.answers"==_.get(toState,"name")&&"list"!=_.get(toParams,"postSlug")&&(subPath="question/"+subPath.substring(subPath.lastIndexOf("/")+1)),$window.ga("send","pageview",{page:subPath,title:toState.data&&toState.data.title?toState.data.title:""}),$window.ga("send",{hitType:"event",eventCategory:"ActionsApp",eventAction:"navigation",eventLabel:path}),$rootScope.analyticsUrl=location.protocol+"//"+location.host+"/"+subPath,"city.faq.child.answers"==_.get(toState,"name")&&"list"!=_.get(toParams,"postSlug")&&
// Send `Answer` event
$window.ga("send",{eventLabel:toState.data&&toState.data.title?toState.data.title:"",hitType:"event",eventCategory:"Answer",eventAction:$rootScope.analyticsUrl,eventValue:1})}fromState.name&&fromState.name.length&&(!toState.data||!toState.data||!toState.data.skipScroll)}),
// Helper function detects the correct sub route to go to (for templating)
$rootScope.goSubRoute=function(baseRoute,subRoute,baseName){baseName=void 0==baseName?"base":baseName;var stateName=baseRoute+"."+subRoute;try{var state=$state.get(stateName);if(void 0==state||null==state)throw"myException"}catch(e){stateName=baseRoute+"."+baseName}$state.go(stateName)}}]).directive("parent",function($rootScope,Menu311,$location){return{restrict:"C",link:function($scope,$element,$attrs){$location.$$path&&"/"!=$location.$$path||$location.path(Menu311.getDefaultUrl($rootScope.appId))}}}),
//angular.module('app.faq', [
//  'ui.router' 
//])
angular.module("311AppParent").config(["$stateProvider","$urlRouterProvider","Menu311Provider",function($stateProvider,$urlRouterProvider,Menu311Provider){
// Redirect if on city hompage
// $urlRouterProvider.when(/\//i, ['$match', '$stateParams', function ($match, $stateParams) {
//   return '/answers';
// }]);
// $urlRouterProvider.otherwise(Menu311Provider.default311Url);
$stateProvider.state("city",{url:"/city","abstract":!0,template:"<div app-311-wrap></div>"})}]),angular.module("wordpressService",["ngResource"]).factory("Post",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+":postType/:id",{id:"@nid",postType:"@postType",per_page:100},{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!1},query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!1,isArray:!0}})}]).factory("TaxonomyTerm",["$resource","$rootScope",function($resource,$rootScope){var params={vocabulary:"@vocabulary",per_page:100};return $rootScope.categorySection&&(params.field_faq_section=$rootScope.categorySection),$resource($rootScope.apiUrl+":vocabulary/:tid",params,{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1},query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!0}})}]),angular.module("311AppParent").filter("termById",function(){return function(items,id){for(var i=0;i<items.length;i++)if(parseInt(items[i].id)==parseInt(id))return items[i];return null}}).filter("termBySlug",function(){return function(items,slug){for(var i=0;i<items.length;i++)if(items[i].slug===slug)return items[i];return null}}).filter("termsNoParent",function(){return function(items,categories){for(var filtered=[],i=0;i<items.length;i++)0==items[i].parent&&(categories?categories.indexOf(items[i].slug)>=0&&filtered.push(items[i]):filtered.push(items[i]));return filtered}}).filter("termsByParent",function(){return function(items,id){for(var filtered=[],i=0;i<items.length;i++)items[i].parent==id&&filtered.push(items[i]);return filtered}}),angular.module("311App",["wordpressService","issueService","paymentService","ui.router","ngSanitize","ngAnimate","ngTouch","scrollTo","ngResource"]).run(["$rootScope","$state","$stateParams","$window","$location",function($rootScope,$state,$stateParams,$window,$location){
// Api Options
// ---------------------------
$rootScope.apiUrl=_.get(Proud,"settings.proud_actions_app.global.api_path")||"https://example.proudcity.com/wp-json/wp/v2/",$rootScope.proudcityApiUrl=_.get(Proud,"settings.global.proudcity_api")||"http://localhost:4000",$rootScope.proudcitySiteId=_.get(Proud,"settings.global.proudcity_site_id")||"san-rafael-ca.proudcity.com",$rootScope.paymentUrl=_.get(Proud,"settings.proud_actions_app.global.payment_url")||"https://demo-api.proudcity.com/api/proudcity/invoice-example",//$rootScope.proudcityApi + 'invoice-example';
$rootScope.trackUrl=_.get(Proud,"settings.proud_actions_app.global.track_url")||"http://markaspot.helmcivic.com/georeport/v2",$rootScope.googleKey=_.get(Proud,"settings.global.google_key")||"",$rootScope.googleElectionId=_.get(Proud,"settings.proud_actions_app.global.google_election_id")||"2000",
// Global options
// ---------------------------
$rootScope.activeCity=_.get(Proud,"settings.global.location.city")||"Huntsville",$rootScope.activeState=_.get(Proud,"settings.global.location.state")||"Alabama",$rootScope.location=_.get(Proud,"settings.global.location")||{lat:0,lng:0},$rootScope.mapboxAccessToken=_.get(Proud,"settings.global.mapbox.token")||"",$rootScope.mapboxMap=_.get(Proud,"settings.global.mapbox.map")||"",
// Helper function returns boolean for if we're in "full page mode"
$rootScope.displayExpanded=function(section){return section==$rootScope.appPageDisplay},
// Function allows for manipulating the offcanvase slide
$rootScope.toggleMain=function(toggleClass,toggleType,select){switch(select=select||"",toggleType){case"remove":jQuery("#main-311"+select).removeClass(toggleClass);break;case"add":jQuery("#main-311"+select).addClass(toggleClass);break;default:jQuery("#main-311"+select).toggleClass(toggleClass)}}}]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function($locationProvider,$stateProvider,$urlRouterProvider){}]).directive("app311Wrap",function($window,$rootScope){return{restrict:"AC",templateUrl:"views/apps/311App/app-311-wrap.html",transclude:!0,link:function($scope,$element,$attrs){
// Display options
// ---------------------------
// Expand categories?
$rootScope.appPageDisplay=_.get(Proud,"settings.proud_actions_app.instances."+$rootScope.appId+".expand_section")||!1;
// Restrict to visitor, resident, ect ?
var categories=_.get(Proud,"settings.proud_actions_app.instances."+$rootScope.appId+".category_section")||!1;categories&&(categories=_.transform(_.values(categories),function(res,v,k){v&&"0"!==v&&res.push(v)})),$rootScope.categories=categories}}}),angular.module("311App").directive("menu",function($rootScope,Menu311,$state){return{restrict:"A",templateUrl:"views/apps/311App/menu311.html",link:function($scope,$element,$attrs){
// Push to scope
$scope.menu=Menu311.getMenu($rootScope.appId)}}}).directive("mainToggle",function($window,$rootScope){return{restrict:"A",scope:{mainToggle:"@",mainToggleNest:"@",mainToggleForce:"@",mainToggleEnter:"@"},link:function($scope,$element,$attrs){var select=$scope.mainToggleNest?"-"+$scope.mainToggleNest:"";
// Are we a link?
$scope.mainToggleEnter?$rootScope.toggleMain($scope.mainToggle,$scope.mainToggleForce,select):
// listen for a click
$element.on("click",function(){
// Animate down if necessary
// if($rootScope.currentYPosition() < 300) {
//   $('html, body').animate({
//     scrollTop: $('#wrapper-311').offset().top - 170
//   }, 300);
// }
$rootScope.toggleMain($scope.mainToggle,$scope.mainToggleForce,select)})}}}).directive("menuClick",function($window,$browser){return{restrict:"A",link:function($scope,$element,$attrs){$element.on("click",function(event){if(jQuery(".app-wrap").toggleClass("show-nav"),$attrs.menuClick&&"return-false"==$attrs.menuClick)return event.stopPropagation(),!1})}}}).directive("href",function($rootScope){return{restrict:"A",link:function($scope,$element,$attrs){if($rootScope.externalLinkWindow){var a=new RegExp("/"+window.location.host+"/"),href=void 0!=$attrs.ngHref?$attrs.ngHref:$attrs.href;void 0==href||href.indexOf("http")==-1||a.test(href)||$element.attr("target","_blank")}}}}),angular.module("311App").provider("Menu311",function(){
// Init Proud   
var self=this,active311Items=null,default311Url=null,menu=[],initMenu=function(appId){
// Only run once
if(!active311Items){var instance="settings.proud_actions_app.instances."+appId;active311Items=_.get(Proud,instance+".active_tabs")||{faq:!0,payments:!0,report:!0,status:!0};var issue=_.get(Proud,"settings.proud_actions_app.global.issue")||{service:"seeclickfix"};
// Push objects
_.forEach(active311Items,function(item,key){switch(key){case"faq":item&&"0"!==item&&(menu.push({title:"Get Answers",state:"faq",icon:"fa-question-circle"}),default311Url||(default311Url="/city/answers"));break;case"payments":item&&"0"!==item&&(menu.push({title:"Make a Payment",state:"payments",icon:"fa-credit-card"}),default311Url||(default311Url="/city/payments"));break;case"report":if(item&&"0"!==item){var item={title:"Report an Issue",icon:"fa-exclamation-triangle"};"link"==issue.service?item.url=issue.link_create:item.state="report",menu.push(item),default311Url||(default311Url="/city/report")}break;case"status":if(item&&"0"!==item){var item={title:"Check Status",icon:"fa-wrench"};"link"==issue.service?item.url=issue.link_status:item.state="status",menu.push(item),default311Url||(default311Url="/city/status")}break;case"vote":if(item&&"0"!==item){var item={title:"Vote",icon:"fa-check-square-o"};item.state="vote",menu.push(item),default311Url||(default311Url="/city/vote/address")}break;case"custom":if(item&&"0"!==item){var item={title:_.get(Proud,instance+".custom_title")||"",icon:_.get(Proud,instance+".custom_icon")||""};item.state="custom",menu.push(item),default311Url||(default311Url="/city/tab")}}})}};self.getDefaultUrl=function(appId){return initMenu(appId),default311Url},self.getMenu=function(appId){return initMenu(appId),menu},
// Just return self
self.$get=function(){return self}}),angular.module("issueService",["ngResource"]).factory("IssueTypes",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.proudcityApiUrl+"/issues/:siteId/types",{siteId:$rootScope.proudcitySiteId},{query:{isArray:!1}})}]).factory("IssueFields",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.proudcityApiUrl+"/issues/:siteId/types/:type",{siteId:$rootScope.proudcitySiteId,type:"@type"})}]).factory("Issue",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.proudcityApiUrl+"/issues/:siteId/:code",{siteId:$rootScope.proudcitySiteId,code:"@code"},{get:{isArray:!1}})}]).factory("IssueAddress",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.proudcityApiUrl+"/issues/:siteId/types/:type/address",{siteId:$rootScope.proudcitySiteId,type:"@type"},{get:{isArray:!1}})}]),angular.module("paymentService",["ngResource"]).factory("Payment",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.paymentUrl+"?number",{number:"@number"},{get:{cache:!0}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.faq",{url:"/answers",templateUrl:"views/apps/311App/faq/faq.html",data:{title:"FAQ",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},resolve:{terms:function($stateParams,$rootScope,TaxonomyTerm){return TaxonomyTerm.query({vocabulary:"faq-topic"}).$promise.then(function(data){return data})}},controller:function($scope,$rootScope,$state,terms,$window){$scope.terms=terms,$scope.active=null,$scope.childOpen=!1,$scope.open=function(item){$window.ga("send",{hitType:"event",eventCategory:"ActionsApp",eventAction:"category open",eventLabel:item.slug}),$scope.active=item},$scope.openChildren=function(){$scope.childOpen=!0}}}).state("city.faq.child",{url:"/:slug",templateUrl:"views/apps/311App/faq/faq-child.html",data:{title:"FAQ",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords
undoMainToggle:!1},controller:function($scope,$rootScope,$state,$filter,terms,Post){$scope.activeTerm=$filter("termBySlug")(terms,$state.params.slug),$scope.activeParent=$filter("termById")(terms,$scope.activeTerm.parent),$state.go("city.faq.child.answers",{nid:"list"})}}).state("city.faq.child.answers",{url:"/:postSlug",templateUrl:"views/apps/311App/faq/faq-child-answers.html",data:{title:"FAQ",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page"},controller:function($scope,$rootScope,$state,$filter,$window,Post){$scope.activeSlug="list"!=$state.params.postSlug?$state.params.postSlug:null,
// @todo: put this in resolve
Post.query({postType:"questions","filter[faq-topic]":$state.params.slug,sort:"title",direction:"ASC"}).$promise.then(function(data){$scope.nodes=data}),
// Click event for heart button
$scope.heartClick=function(node,e){e.preventDefault(),node.hearted=void 0==node.hearted||!node.hearted,$window.ga("send",{hitType:"event",eventCategory:"Score",eventLabel:node.title.rendered,eventAction:$rootScope.analyticsUrl,eventValue:node.hearted?5:-5}),node.hearted&&$window.ga("send",{hitType:"event",eventCategory:"Heart",eventLabel:node.title.rendered,eventAction:$rootScope.analyticsUrl,eventValue:node.hearted?1:-1})}}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){
//.when('', '/answers');
$stateProvider.state("city.status",{url:"/status",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Check Status"},templateUrl:"views/apps/311App/issues/issue-status.html",controller:function($scope,$rootScope,$state,$timeout,Issue){
//$scope.code = 'd2a6-1'; // @todo: default value, remove
//console.log('a', jQuery('#map-wrapper'));
$scope.tabClick=function(tab,e){e.preventDefault(),$scope.activeTab=tab},$scope.city=$rootScope.activeCity,$timeout(function(){$scope.showMap=jQuery(".widget-proud-map-app").length},2e3),
//console.log($scope);
$scope.clickMap=function(e){jQuery("#map-wrapper").trigger("click"),jQuery("#menu-ui a:last").trigger("click"),e.preventDefault()},
// Get myIssues
$scope.hasMyIssues=!1;var local=localStorage.getItem("reportedIssues");local===-1&&($scope.hasMyIssues=-1),local&&local!==-1&&($scope.myIssues=JSON.parse(local),$scope.activeTab="me",$scope.hasMyIssues=!0),
// Get recent issues
$scope.recentIssues=[],$scope.recentLoading=!0,Issue.query().$promise.then(function(data){$scope.recentLoading=!1,$scope.recentIssues=data}),$scope.activeTab=$scope.hasMyIssues?"me":"recent",$scope.issueThumb=function(item){return item.thumb?item.thumb:"https://api.mapbox.com/v4/mapbox.emerald/"+item.lng+","+item.lat+",13/300x300@2x.png?access_token="+$rootScope.mapboxAccessToken},
// Get recent issues (preload)
// No remember checkbox callback
$scope.showLocalCheckbox=!0,$scope.toggleSave=function(){var local=localStorage.getItem("reportedIssues");local=local===-1?[]:-1,localStorage.setItem("reportedIssues",local),local==-1&&(alert("We have deleted your saved issues and will not store issues you submit on this device in the future."),$scope.showLocalCheckbox=!1)}}}).state("city.status.item",{url:"/:code?saved",data:{undoMainToggle:!1},templateUrl:"views/apps/311App/issues/issue-status-result.html",controller:function($scope,$rootScope,$state,$window,Issue){$scope.code=$state.params.code,$scope.currentUrl="",$scope.loading=!0,$scope.error=!1,$scope.saved=$state.params.saved,Issue.get({code:$state.params.code}).$promise.then(function(data){$scope.loading=!1,void 0!=data?($scope.item=data,$scope.currentUrl=$window.location.href.substring(0,$window.location.href.indexOf("?"))):$scope.error=!0})}}).state("city.report",{url:"/report",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Report Issue"},templateUrl:"views/apps/311App/issues/issue-create-categories.html",resolve:{services:function($stateParams,IssueTypes,Post,$rootScope){var issue=_.get(Proud,"settings.proud_actions_app.global.issue")||{service:"seeclickfix"};return"seeclickfix"==issue.service?IssueTypes.query().$promise.then(function(data){return void 0!=data.request_types?data.request_types:null}):Post.query({postType:"issues",sort:"title",direction:"ASC"}).$promise.then(function(data){return data})}},controller:function($scope,$rootScope,$state,services){var issue=_.get(Proud,"settings.proud_actions_app.global.issue")||{service:"seeclickfix"};$scope.service=issue.service,$scope.types=services}}).state("city.report.iframe",{url:"/embed/:slug",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Report Issue"},templateUrl:"views/apps/311App/issues/issue-create-iframe.html",resolve:{post:function($stateParams,$filter,services){return $filter("filter")(services,{slug:$stateParams.slug})[0]}},controller:function($scope,$rootScope,$state,$sce,post){$scope.post=post,$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)}}}).state("city.report.map",{url:"/:type",data:{undoMainToggle:!1,// Force "offcanvas" class off
undoChildToggle:1},templateUrl:"views/apps/311App/issues/issue-create-map.html",controller:function($scope,$rootScope,$state,$http){$scope.type=$state.params.type,$scope.next=function(){if(void 0!=$scope.marker&&$scope.marker){var latlng=$scope.marker.getLatLng();$state.go("city.report.map.details",{lat:latlng.lat,lng:latlng.lng})}else alert("Please enter an address, or click the Locate button to use your current location.")},$scope.$watch("config",function(value){L.mapbox.accessToken=$rootScope.mapboxAccessToken;var map=new L.mapbox.Map("issue-map",$rootScope.mapboxMap,{center:new L.LatLng($rootScope.location.lat,$rootScope.location.lng),zoom:15,scrollWheelZoom:!1});$scope.marker=null;var addMarker=function(self){var latlng=void 0!=self.latlng?self.latlng:new L.LatLng(self.feature.center[1],self.feature.center[0]);$scope.marker=L.marker(latlng,{icon:L.mapbox.marker.icon({"marker-color":"ff8888"}),draggable:!0}).addTo(map),$scope.$apply()};
// Add marker when the map is clicked (if it hasn't already been added)
map.on("click",function(self){null===$scope.marker&&addMarker(self)}),
// Add geocode control, add marker when selected
map.addControl(L.mapbox.geocoderControl("mapbox.places",{keepOpen:!0,autocomplete:!0}).on("select",addMarker).on("autoselect",addMarker)),
// Add locate control, add marker when located
L.control.locate({drawCircle:!0}).addTo(map),map.on("locationfound",addMarker)})}}).state("city.report.map.details",{url:"/details?lat&lng",data:{undoChildToggle:!1},templateUrl:"views/apps/311App/issues/issue-create-details.html",resolve:{data:function($stateParams,$rootScope,IssueFields){return IssueFields.get({type:$stateParams.type}).$promise.then(function(data){return{categoryTitle:data.title,fields:data.questions}})}},controller:function($scope,$rootScope,$state,data,Issue,IssueAddress){$scope.type=$state.params.type,$scope.form={request_type_id:$scope.type,lat:$state.params.lat,lng:$state.params.lng,answers:{}},$scope.fields=data.fields,$scope.form.category=data.categoryTitle,$scope.form.address=data.address,$scope.submitLabel="Continue with SeeClickFix",$scope.guestAllowed=!0,$scope.form.guest=!1,$scope.toggleGuest=function(e){e.preventDefault(),$scope.form.guest=!$scope.form.guest,$scope.submitLabel="Submit"},$scope.form.address="",IssueAddress.get({type:$state.params.type,lat:$state.params.lat,lng:$state.params.lng}).$promise.then(function(data){$scope.form.address=data.address}),$scope.submit=function(data){/*var issue = new TrackIssue(data);
              issue.$save(function(data, putResponseHeaders) {
                console.log(data);
                //u => saved user object
                //putResponseHeaders => $http header getter
              });*/
if(data.guest){var issue=new Issue(data);issue.$save(function(data){
// Save issue history in localStorage
var local=localStorage.getItem("reportedIssues");
//local = '[]';
local!==-1&&(local=local?JSON.parse(local):[],local.push({created_at:data.created_at,title:data.summary,id:data.id,address:data.address}),localStorage.setItem("reportedIssues",JSON.stringify(local))),
// Redirect
$state.go("city.status.item",{code:data.id,saved:local===-1?1:2})},function(err){
// @todo: better error handling here
$scope.errors="";for(var i in err.data.errors)$scope.errors+="<div>"+err.data.errors[i][0]+"</div>"})}else{var url="https://test.seeclickfix.com/oauth/authorize?response_type=code&client_id=YOUR_CLIENT_ID&redirect_uri=http://api.proudcity.com:4000";window.open(url,"authorize","width=400,height=420")}}}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.payments",{templateUrl:"views/apps/311App/payment/payment.html",data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0,// Force "offcanvas" class off
title:"Payments"},url:"/payments",resolve:{posts:function($stateParams,Post){return Post.query({postType:"payments"}).$promise.then(function(data){return data})}},controller:function($scope,$rootScope,$state,posts){$scope.posts=posts}}).state("city.payments.type",{templateUrl:"views/apps/311App/payment/payment-type.html",url:"/:slug",resolve:{post:function($stateParams,$filter,posts){return $filter("filter")(posts,{slug:$stateParams.slug})[0]}},controller:function($scope,$rootScope,$state,post,Payment){
//console.log(post);
$scope.post=post,$scope.demoInfo=!1,$scope.payment={id:"",amount:""},$scope.idClass="",$scope.demoInfoToggle=function(e){$scope.demoInfo=!$scope.demoInfo,e.preventDefault()},
// Talk to invoice API
$scope.$watch("payment.id",function(){""!=$scope.payment.id&&$scope.payment.id.length>3?($scope.idClass="has-warning",Payment.get({city:void 0!=$scope.location?$scope.location.city:null,state:void 0!=$scope.location?$scope.location.state:null,id:$scope.payment.id},function(data){void 0!=data.amount?($scope.payment.amount=data.amount,$scope.payment.name=data.name,$scope.idClass="has-success"):($scope.payment.amount="",$scope.idClass="has-error")})):$scope.idClass=""}),
// Submit
$scope.submit=function(payment){window.location=$scope.post.link+"?amount="+$scope.payment.amount+"&id="+$scope.payment.id}}}).state("city.payments.success",{templateUrl:"views/apps/311App/payment/payment-success.html",url:"/:nid/:token",resolve:{post:function($stateParams,$filter,posts){return $filter("filter")(posts,{nid:$stateParams.nid})[0]}},controller:function($scope,$rootScope,$state,post,Payment){}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.custom",{template:'<div ng-bind-html="content" class="slide-left-2"></div>',data:{doScroll:!1,// No scroll on route change
undoMainToggle:!0},url:"/tab",controller:function($scope,$rootScope,$state,$sce){$scope.content=$sce.trustAsHtml(_.get(Proud,"settings.proud_actions_app.instances."+$rootScope.appId+".custom_content")||"")}})}]),angular.module("311App").directive("shareBlock",function($window,$browser,$http){return{restrict:"A",template:'<a ng-click="fbScript($event)" href="https://www.facebook.com/sharer/sharer.php" target="_blank"><i class="fa fa-facebook-square fa-fw"></i><span>Facebook</span></a> &nbsp;<a ng-click="twitScript($event)" href="http://twitter.com/share"><i class="fa fa-twitter-square fa-fw"></i><span>Twitter</span></a> &nbsp;<a ng-href="{{mailTo()}}"><i class="fa fa-envelope fa-fw"></i><span>Email</span></a>',controller:function($element,$scope,$window){var href=$element.attr("href")?$element.attr("href"):$window.location.origin.replace("-embed",""),title=$element.attr("title"),summary=$element.attr("summary");$scope.mailTo=function(){return"mailto:?subject="+encodeURIComponent(title)+"&body="+encodeURIComponent(summary)+" "+encodeURIComponent(href)},$scope.fbScript=function($e){$e.preventDefault(),$window.open("//www.facebook.com/sharer.php?m2w&s=100&p[url]="+encodeURIComponent(href)+"&p[title]="+encodeURIComponent(title)+"&p[summary]="+encodeURIComponent(summary)+"&p[images][0]="+encodeURIComponent("https://proudcity.com/wp-content/uploads/2015/12/pc-icon-blue-square.png"),"_blank","scrollbars=0, resizable=1, menubar=0, left=100, top=100, width=550, height=440, toolbar=0, status=0")},$scope.twitScript=function($e){$e.preventDefault(),$window.open("//twitter.com/intent/tweet?url="+encodeURIComponent(href)+"&text="+encodeURIComponent(title+" "+summary),"_blank","scrollbars=0, resizable=1, menubar=0, left=100, top=100, width=550, height=440, toolbar=0, status=0")}}}}),angular.module("311App").directive("googleplace",function($rootScope){return{require:"ngModel",scope:{ngModel:"@",place:"@"},link:function(scope,element,attrs,model){var options={types:[],componentRestrictions:{country:"us"}};scope.gPlace=new google.maps.places.Autocomplete(element[0],options),google.maps.event.addListener(scope.gPlace,"place_changed",function(){$rootScope.chosenPlace=scope.gPlace.getPlace(),scope.$apply(function(){model.$setViewValue(element.val())})})}}}),angular.module("311App").factory("GoogleCivicInfo",["$resource","$rootScope",function($resource,$rootScope){return $resource("https://www.googleapis.com/civicinfo/v2/voterinfo",{key:$rootScope.googleKey,electionId:$rootScope.googleElectionId},{query:{isArray:!1}})}]),angular.module("311App").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("city.vote",{url:"/vote",template:"<div ui-view></div>",data:{title:"Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$window){$state.go("city.vote.address")}}).state("city.vote.embed",{url:"/embed",templateUrl:"views/apps/311App/vote/vote-embed.html",data:{title:"Embed",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0}}).state("city.vote.address",{url:"/address",templateUrl:"views/apps/311App/vote/vote-address.html",data:{title:"Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$window){$scope.place=null,$scope.chosenPlace=null,$rootScope.chosenPlace=null,$scope.chosenUpdate=function(){null!=$rootScope.chosenPlace&&($scope.chosenPlace=$rootScope.chosenPlace,$state.go("city.vote.location",{latlng:$rootScope.chosenPlace.geometry.location.lat()+","+$rootScope.chosenPlace.geometry.location.lng(),address:$rootScope.chosenPlace.formatted_address}))}}}).state("city.vote.location",{url:"/:latlng/:address",templateUrl:"views/apps/311App/vote/vote-wrapper.html",data:{title:"Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},resolve:{data:function($stateParams,$rootScope,GoogleCivicInfo){return GoogleCivicInfo.query({address:$stateParams.address}).$promise.then(function(data){if(data.election){var date=new Date(data.election.electionDay),monthNames=["Jan","Feb","March","April","May","June","July","Aug","Sep","Oct","Nov","Dec"];data.election.date={days:Math.round((date-new Date)/864e5),month:monthNames[date.getUTCMonth()],day:date.getUTCDate(),year:date.getUTCFullYear()}}return data})}},controller:function($scope,$rootScope,$state,$window,data){$state.go("city.vote.location.how"),data.election&&($scope.date=data.election.date)}}).state("city.vote.location.how",{url:"/how",templateUrl:"views/apps/311App/vote/vote-how.html",data:{title:"How to Vote",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$window,data){var home=$state.params.latlng.split(",");home=new google.maps.LatLng(parseFloat(home[0]),parseFloat(home[1]));var geocoder=new google.maps.Geocoder,bounds=new google.maps.LatLngBounds,myOptions={zoom:14,center:home,mapTypeId:google.maps.MapTypeId.ROADMAP},map=new google.maps.Map(document.getElementById("google-map"),myOptions);
// Add home pin
// Custom icons from https://sites.google.com/site/gmapsdevelopment/
new google.maps.Marker({map:map,position:home,title:"Your address".toUpperCase(),icon:"//maps.google.com/mapfiles/kml/pal3/icon31.png",shadow:"//maps.google.com/mapfiles/kml/pal3/icon31s.png"}),bounds.extend(home);
// Helper function
var marker;$scope.addMarker=function(address,label,color){geocoder.geocode({address:address},function(results,status){"OK"==status&&(marker=new google.maps.Marker({map:map,position:results[0].geometry.location,title:label.toUpperCase(label),icon:"//raw.githubusercontent.com/Concept211/Google-Maps-Markers/master/images/marker_"+color+".png"}),bounds.extend(marker.getPosition()),map.fitBounds(bounds))})},
// Add polling place pins
data.pollingLocations="array"==typeof data.pollingLocations?data.pollingLocations:[];var combinedLocations=data.pollingLocations.concat(data.earlyVoteSites);if(combinedLocations=void 0==combinedLocations[0]?[]:combinedLocations,void 0!=combinedLocations&&combinedLocations.length>0){var addr,address;for(var i in combinedLocations)addr=combinedLocations[i].address,address=addr.line1+", "+(void 0!=addr.line2?addr.line2+", ":"")+addr.city+", "+addr.state+" "+addr.zip,$scope.addMarker(address,"Polling place: "+addr.locationName,i>=data.pollingLocations.length?"green":"orange");$scope.directionsLink="//maps.google.com/maps/dir/"+encodeURIComponent($state.params.latlng)+"/"+encodeURIComponent(address),$scope.address=combinedLocations[0].address,$scope.hours=combinedLocations[0].pollingHours.replace(/\n/g,"<br>");var arrHrs=$scope.hours.split("<br>");$scope.shortHours=arrHrs.length>3?[arrHrs[0],arrHrs[1],arrHrs[2]].join("<br>"):null,$scope.longHours=!1,$scope.sources=combinedLocations[0].sources,$scope.isEarly=i>=data.pollingLocations.length}$scope.links=data.state?data.state[0].electionAdministrationBody:null,$scope.date=data.election.date,$scope.disclaimer=!1,$scope.toggleDisclaimer=function($e){$e.preventDefault(),$scope.disclaimer=!$scope.disclaimer},$scope.getDirections=function($e){$e.preventDefault(),window.open($scope.directionsLink)},$scope.toggleHours=function($e){$e.preventDefault(),$scope.longHours=!$scope.longHours},$scope.mapScroll=function($e){$e.preventDefault(),document.getElementById("google-map").scrollIntoView(!0)}}}).state("city.vote.location.issues",{url:"/issues",templateUrl:"views/apps/311App/vote/vote-issues.html",data:{title:"Issues",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$filter,data){$scope.contests=$filter("filter")(data.contests,{type:"Referendum"}),$scope.active=null,$scope.setActive=function(val,$e){$e.preventDefault(),$scope.active=val}}}).state("city.vote.location.candidates",{url:"/candidates",templateUrl:"views/apps/311App/vote/vote-candidates.html",data:{title:"Candidates",// Sets meta title
description:"About the about",// Sets different meta description
keywords:"About, this, page",// Sets different meta keywords,
doScroll:!1,// no scroll on route change
undoMainToggle:!0},controller:function($scope,$rootScope,$state,$filter,data){$scope.contests=$filter("filter")(data.contests,{type:"General"}).slice().reverse(),$scope.googleSearch=function(name,loc,$e){$e.preventDefault(),window.open("//google.com/search?q="+encodeURIComponent(name))}}})}])}(jQuery);